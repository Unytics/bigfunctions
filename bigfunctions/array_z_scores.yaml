type: function_sql
category: transform_array
author:
  name: Julien Awonga
  url: https://linkedin.com/in/julienawonga
  avatar_url: "https://media.licdn.com/dms/image/D4E03AQFf9Qpnl0adhg/profile-displayphoto-shrink_400_400/0/1690023383639?e=1721260800&v=beta&t=StL_M-62Xv8rvUaHFxdFu4kCnKr-tSm7PDMkjKn72L8"
description: |
  Returns an array of z-scores, which are standardized values showing how many standard deviations each element is from the mean.
arguments:
  - name: arr
    type: any type
output:
  name: array_z_scores
  type: any type
examples:
  - description: ""
    arguments:
      - "[1, 2, 3, 4, 5, 0]"
    output: "[−1.414,−0.707,0,0.707,1.414,−1.46]"
code: |
  (
    WITH stats AS (
    select 
      avg(value) AS mean, 
      stddev_pop(value) AS stddev
    FROM unnest(arr) AS value
    )
    select array_agg(coalesce(safe_divide(value - stats.mean,  stats.stddev), 0))
    from unnest(arr) as value
    cross join stats
  )
